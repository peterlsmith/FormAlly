"use strict";!function(){let t=t=>{throw Error(t)},e=(...t)=>t.reduce((t,e)=>t.concat(e),[]),o={email:/^[\w.%+-]+@[\w.-]+\.[\w]{2,}$/,web_url:/^(?:https?:\/\/)?[\w.-]+\.[A-Za-z.]{2,13}(?:\/[\w.+#%@~-]*)*\/?(?:\?[\w.+#%@~=&amp;-]*)?$/,web_url_full:/^https?:\/\/[\w.-]+\.[A-Za-z.]{2,13}(?:\/[\w.+#%@~-]*)*\/?(?:\?[\w.+#%@~=&amp;-]*)?$/,integer:/^[0-9]+$/},s=e=>null==e?document.body:e.nodeName?e:"string"==typeof e?document.querySelector(e):e.selector?e.get(0):void t("Unsupported source element selector type");function n(){this.listeners__=[]}n.prototype.onChange=function(t){this.listeners__.push(t)},n.prototype.offChange=function(t){this.listeners__=this.listeners__.filter(e=>e!==t)},n.prototype.changed=function(...t){this.listeners__.forEach(e=>e.apply(this,t))};let r=function(){n.call(this),this.state__=void 0};r.prototype=Object.create(n.prototype),r.prototype.reset=()=>console.error("Predicate reset method not implemented"),r.prototype.destroy=()=>console.error("Predicate destroy method not implemented"),r.prototype.state=function(t){t!=this.state__&&this.changed(this.state__=t)},r.prototype.getState=function(){return this.state__};let i=function(){r.call(this)};i.prototype=Object.create(r.prototype),i.prototype.reset=function(){this.state(!0)},i.prototype.destroy=()=>{},r.true=()=>new i;let a=function(){r.call(this)};a.prototype=Object.create(r.prototype),a.prototype.reset=function(){this.state(!0)},a.prototype.destroy=()=>{},r.false=()=>new a;let l=function(...t){r.call(this),this.sources=e(t),this.data=Array(this.sources.length),this.listener=Array(this.sources.length);let o=(t,e)=>{e!==this.data[t]&&(this.data[t]=this[`data_${t}`]=e,this.check())};this.sources.forEach((t,e)=>{this.listener[e]=t=>o.call(this,e,t),t.onChange(this.listener[e])})};l.prototype=Object.create(r.prototype),l.prototype.reset=function(){for(let t of this.sources)t.reset()},l.prototype.destroy=function(){for(let t of(this.sources.forEach((t,e)=>t.change(this.listener[e])),this.sources))t.destroy()},l.prototype.check=()=>console.error("Predicate check method not implemented"),r.general=l;let c=function(t,...e){l.call(this,...e),this.fn=t};c.prototype=Object.create(l.prototype),c.prototype.check=function(){this.state(this.fn(this.data))},r.function=c;let h=function(...t){l.call(this,...t),this.original_value=Array(this.data.length)};h.prototype=Object.create(l.prototype),h.prototype.reset=function(){l.prototype.reset.call(this),this.original_value=this.data.map(t=>t),this.state(!1)},h.prototype.check=function(){this.state(this.original_value.some((t,e)=>t!=this.data[e]))},r.changed=(...t)=>new h(...t),r.equal=(...t)=>new c(t=>t.every(e=>e===t[0]),...t),r.pattern=(t,...e)=>{let o="string"==typeof t?RegExp(t):t;return new c(t=>t.every(t=>o.test(t)),...e)},r.range=(t,e,...o)=>{let s=parseFloat(t),n=parseFloat(e);return new c(t=>t.every(t=>{let e=parseFloat(t);return!(Number.isNaN(e)||!Number.isNaN(s)&&e<s||!Number.isNaN(n)&&e>n)}),...o)},r.exclude=(t,...e)=>{let o=t.map(t=>t.toLowerCase());return new c(t=>t.every(t=>!o.includes(t.toLowerCase())),...e)};let p=function(t,...o){for(let s of(r.call(this),this.fn=t,this.predicates=e(o),this.listener=()=>this.check(),this.predicates))s.onChange(this.listener)};p.prototype=Object.create(r.prototype),p.prototype.reset=function(){for(let t of this.predicates)t.reset()},p.prototype.destroy=function(){for(let t of this.predicates)t.offChange(this.listener),t.destroy()},p.prototype.check=function(){this.state(this.fn(this.predicates))},r.logic=p,r.and=(...t)=>new p(t=>t.every(t=>t.getState()),...t),r.or=(...t)=>new p(t=>t.some(t=>t.getState()),...t),r.not=t=>new p(t=>!t[0].getState(),t);let u=function(){n.call(this)};u.prototype=Object.create(n.prototype),u.prototype.reset=()=>{},u.prototype.destroy=()=>{};let y=function(t){u.call(this),this.value=t};y.prototype=Object.create(u.prototype),y.prototype.reset=function(){this.changed(this.value)},u.constant=t=>new y(t);let d=function(e){switch(u.call(this),null!=e||t("Empty source element selector"),this.input=s(e),this.eventType="input",this.input.getAttribute("type")){case"checkbox":this.listener=()=>this.changed(this.input.checked),this.eventType="change";break;case null:"SELECT"===this.input.nodeName&&(this.eventType="change");default:this.listener=()=>this.changed(this.input.value)}this.input.addEventListener(this.eventType,this.listener)};d.prototype=Object.create(u.prototype),d.prototype.reset=function(){this.listener()},d.prototype.destroy=function(){this.input.removeEventListener(this.eventType,this.listener)},u.element=t=>new d(t);let f=Object.create(null);f.all=(...t)=>{let o=e(t);return t=>{for(let e of o)e(t)}},f.function=t=>e=>t.call(null,e),f.alt=t=>e=>t(!e),f.debounce=(t,e)=>{let o;return s=>{o&&window.clearTimeout(t),o=window.setTimeout(()=>{o=void 0,e(s)},t)}},f.style=(t,o,n)=>{let r=s(t),i=e(o),a=e(n);return t=>{t?(r.classList.remove(...a),r.classList.add(...i)):(r.classList.remove(...i),r.classList.add(...a))}},f.enable=t=>{let e=s(t);return t=>{t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}};let g=function(t,e){p.call(this,t=>t.every(t=>t.getState()),t),this.action=f.all(e),this.handler=t=>this.action(t),this.onChange(this.handler)};g.prototype=Object.create(p.prototype),g.prototype.destroy=function(){this.offChange(this.handler),p.prototype.destroy.call(this)};let m=function(...t){if(this==null||this==window)return new m({and:r.and,changed:r.changed,equal:r.equal,exclude:r.exclude,FALSE:r.false,not:r.not,or:r.or,pattern:r.pattern,range:r.range,TRUE:r.true,constant:u.constant,element:u.element,all:f.all,alt:f.alt,style:f.style,debounce:f.debounce,enable:f.enable,func:f.function},...t);let e=Object.create(null);e.predicate=r,e.source=u,e.action=f,e.regex=o,e.validator=(t,e)=>new g(t,e),t.length&&Object.assign(e,...t),this.context=e};m.prototype.fromString=function(t){return Function(...Object.keys(this.context),`{ return ${t} }`)(...Object.values(this.context))},m.validator=(t,e)=>new g(t,e),m.predicate=r,m.source=u,m.action=f,window.formally=m}();